<!doctypehtml><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible"content="IE=edge"><meta name="viewport"content="width=device-width,initial-scale=1"><title>Deploying Microservices Transparently in Clusters with Docker and Nomad</title><meta name="description"content="ᴍɪɢᴜᴇʟ ᴀɴɢᴇʟ ᴅᴏᴍɪɴɢᴜᴇᴢ ᴄᴏʟᴏᴍᴀ"><meta name="robots"content="none"><meta name="robots"content="noindex"><meta name="robots"content="noimageindex"><meta name="robots"content="noarchive"><meta name="robots"content="nositelinkssearchb"><meta name="robots"content="nosnippet"><meta name="robots"content="notranslate"><meta property="og:locale"content="en_US"><meta property="og:type"content="website"><meta property="og:title"content="Deploying Microservices Transparently in Clusters with Docker and Nomad"><meta property="og:description"content="ᴍɪɢᴜᴇʟ ᴀɴɢᴇʟ ᴅᴏᴍɪɴɢᴜᴇᴢ ᴄᴏʟᴏᴍᴀ"><meta property="og:image"content="/images/featured/2017-04-29-deploying-microservices-transparently-in-clusters-with-docker-and-nomad.jpg"><meta property="og:url"content="https://eridem.net/deploying-microservices-transparently-in-clusters-with-docker-and-nomad"><meta property="og:site_name"content="ᴍɪɢᴜᴇʟ ᴀɴɢᴇʟ ᴅᴏᴍɪɴɢᴜᴇᴢ ᴄᴏʟᴏᴍᴀ"><link rel="apple-touch-icon"sizes="180x180"href="/apple-touch-icon.png?v=vMgBga0mbk"><link rel="icon"type="image/png"sizes="32x32"href="/favicon-32x32.png?v=vMgBga0mbk"><link rel="icon"type="image/png"sizes="16x16"href="/favicon-16x16.png?v=vMgBga0mbk"><link rel="manifest"href="/site.webmanifest?v=vMgBga0mbk"><link rel="mask-icon"href="/safari-pinned-tab.svg?v=vMgBga0mbk"color="#5bbad5"><link rel="shortcut icon"href="/favicon.ico?v=vMgBga0mbk"><meta name="msapplication-TileColor"content="#da532c"><meta name="theme-color"content="#ffffff"><meta http-equiv="imagetoolbar"content="no"><link rel="canonical"href="https://eridem.net/deploying-microservices-transparently-in-clusters-with-docker-and-nomad"><link rel="alternate"type="application/rss+xml"title="ᴍɪɢᴜᴇʟ ᴀɴɢᴇʟ ᴅᴏᴍɪɴɢᴜᴇᴢ ᴄᴏʟᴏᴍᴀ"href="/feed.xml"><link href="https://unpkg.com/ionicons@4.2.2/dist/css/ionicons.min.css"rel="stylesheet"><style>/*!------------------------------------------------------------------
[MAIN STYLESHEET]
-------------------------------------------------------------------*/.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.show{display:block}.hide{display:none}.invisible{visibility:hidden}.list-reset{list-style-type:none;margin:0;padding:0}.clearfix ::before,.clearfix::after{content:"";display:table;clear:both}.screen-reader-text{clip:rect(1px,1px,1px,1px);height:1px;overflow:hidden;position:absolute!important;width:1px;word-wrap:normal!important}/*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:rgba(0,0,0,0)}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}blockquote,body,dd,dl,fieldset,figure,h1,h2,h3,h4,h5,h6,hr,legend,ol,p,pre,ul{margin:0;padding:0}li>ol,li>ul{margin-bottom:0}table{border-collapse:collapse;border-spacing:0}address,blockquote,dl,fieldset,figure,h1,h2,h3,h4,h5,h6,hr,ol,p,pre,table,ul{margin-bottom:30px}dd,ol,ul{margin-left:20px}.highlight .hll{background-color:#404040}.highlight{background:#202020;color:#d0d0d0}.highlight .c{color:#999;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .esc{color:#d0d0d0}.highlight .g{color:#d0d0d0}.highlight .k{color:#6ab825;font-weight:700}.highlight .l{color:#d0d0d0}.highlight .n{color:#d0d0d0}.highlight .o{color:#d0d0d0}.highlight .x{color:#d0d0d0}.highlight .p{color:#d0d0d0}.highlight .ch{color:#999;font-style:italic}.highlight .cm{color:#999;font-style:italic}.highlight .cp{color:#cd2828;font-weight:700}.highlight .cpf{color:#999;font-style:italic}.highlight .c1{color:#999;font-style:italic}.highlight .cs{color:#e50808;font-weight:700;background-color:#520000}.highlight .gd{color:#d22323}.highlight .ge{color:#d0d0d0;font-style:italic}.highlight .gr{color:#d22323}.highlight .gh{color:#fff;font-weight:700}.highlight .gi{color:#589819}.highlight .go{color:#ccc}.highlight .gp{color:#aaa}.highlight .gs{color:#d0d0d0;font-weight:700}.highlight .gu{color:#fff;text-decoration:underline}.highlight .gt{color:#d22323}.highlight .kc{color:#6ab825;font-weight:700}.highlight .kd{color:#6ab825;font-weight:700}.highlight .kn{color:#6ab825;font-weight:700}.highlight .kp{color:#6ab825}.highlight .kr{color:#6ab825;font-weight:700}.highlight .kt{color:#6ab825;font-weight:700}.highlight .ld{color:#d0d0d0}.highlight .m{color:#3677a9}.highlight .s{color:#ed9d13}.highlight .na{color:#bbb}.highlight .nb{color:#24909d}.highlight .nc{color:#447fcf;text-decoration:underline}.highlight .no{color:#40ffff}.highlight .nd{color:orange}.highlight .ni{color:#d0d0d0}.highlight .ne{color:#bbb}.highlight .nf{color:#447fcf}.highlight .nl{color:#d0d0d0}.highlight .nn{color:#447fcf;text-decoration:underline}.highlight .nx{color:#d0d0d0}.highlight .py{color:#d0d0d0}.highlight .nt{color:#6ab825;font-weight:700}.highlight .nv{color:#40ffff}.highlight .ow{color:#6ab825;font-weight:700}.highlight .w{color:#666}.highlight .mb{color:#3677a9}.highlight .mf{color:#3677a9}.highlight .mh{color:#3677a9}.highlight .mi{color:#3677a9}.highlight .mo{color:#3677a9}.highlight .sa{color:#ed9d13}.highlight .sb{color:#ed9d13}.highlight .sc{color:#ed9d13}.highlight .dl{color:#ed9d13}.highlight .sd{color:#ed9d13}.highlight .s2{color:#ed9d13}.highlight .se{color:#ed9d13}.highlight .sh{color:#ed9d13}.highlight .si{color:#ed9d13}.highlight .sx{color:orange}.highlight .sr{color:#ed9d13}.highlight .s1{color:#ed9d13}.highlight .ss{color:#ed9d13}.highlight .bp{color:#24909d}.highlight .fm{color:#447fcf}.highlight .vc{color:#40ffff}.highlight .vg{color:#40ffff}.highlight .vi{color:#40ffff}.highlight .vm{color:#40ffff}.highlight .il{color:#3677a9}.container{max-width:1300px;padding-left:20px;padding-right:20px;margin:0 auto}.container-big{max-width:1600px;padding-left:20px;padding-right:20px;margin:0 auto}.row{display:flex;flex-wrap:wrap;flex:0 1 auto;flex-direction:row;box-sizing:border-box;margin-left:-15px;margin-right:-15px}.col{padding-left:15px;padding-right:15px}[class^=col-]{flex:auto}.col-0{width:0%}.col-1{width:8.3333333333%}.col-2{width:16.6666666667%}.col-3{width:25%}.col-4{width:33.3333333333%}.col-5{width:41.6666666667%}.col-6{width:50%}.col-7{width:58.3333333333%}.col-8{width:66.6666666667%}.col-9{width:75%}.col-10{width:83.3333333333%}.col-11{width:91.6666666667%}.col-12{width:100%}.push-0{margin-left:0}.push-1{margin-left:8.3333333333%}.push-2{margin-left:16.6666666667%}.push-3{margin-left:25%}.push-4{margin-left:33.3333333333%}.push-5{margin-left:41.6666666667%}.push-6{margin-left:50%}.push-7{margin-left:58.3333333333%}.push-8{margin-left:66.6666666667%}.push-9{margin-left:75%}.push-10{margin-left:83.3333333333%}.push-11{margin-left:91.6666666667%}.push-12{margin-left:100%}.pull-0{margin-right:0}.pull-1{margin-right:8.3333333333%}.pull-2{margin-right:16.6666666667%}.pull-3{margin-right:25%}.pull-4{margin-right:33.3333333333%}.pull-5{margin-right:41.6666666667%}.pull-6{margin-right:50%}.pull-7{margin-right:58.3333333333%}.pull-8{margin-right:66.6666666667%}.pull-9{margin-right:75%}.pull-10{margin-right:83.3333333333%}.pull-11{margin-right:91.6666666667%}.pull-12{margin-right:100%}@media(max-width:992px){.col-d-0{width:0%}.col-d-1{width:8.3333333333%}.col-d-2{width:16.6666666667%}.col-d-3{width:25%}.col-d-4{width:33.3333333333%}.col-d-5{width:41.6666666667%}.col-d-6{width:50%}.col-d-7{width:58.3333333333%}.col-d-8{width:66.6666666667%}.col-d-9{width:75%}.col-d-10{width:83.3333333333%}.col-d-11{width:91.6666666667%}.col-d-12{width:100%}.push-d-0{margin-left:0}.push-d-1{margin-left:8.3333333333%}.push-d-2{margin-left:16.6666666667%}.push-d-3{margin-left:25%}.push-d-4{margin-left:33.3333333333%}.push-d-5{margin-left:41.6666666667%}.push-d-6{margin-left:50%}.push-d-7{margin-left:58.3333333333%}.push-d-8{margin-left:66.6666666667%}.push-d-9{margin-left:75%}.push-d-10{margin-left:83.3333333333%}.push-d-11{margin-left:91.6666666667%}.push-d-12{margin-left:100%}.pull-d-0{margin-right:0}.pull-d-1{margin-right:8.3333333333%}.pull-d-2{margin-right:16.6666666667%}.pull-d-3{margin-right:25%}.pull-d-4{margin-right:33.3333333333%}.pull-d-5{margin-right:41.6666666667%}.pull-d-6{margin-right:50%}.pull-d-7{margin-right:58.3333333333%}.pull-d-8{margin-right:66.6666666667%}.pull-d-9{margin-right:75%}.pull-d-10{margin-right:83.3333333333%}.pull-d-11{margin-right:91.6666666667%}.pull-d-12{margin-right:100%}}@media(max-width:768px){.col-t-0{width:0%}.col-t-1{width:8.3333333333%}.col-t-2{width:16.6666666667%}.col-t-3{width:25%}.col-t-4{width:33.3333333333%}.col-t-5{width:41.6666666667%}.col-t-6{width:50%}.col-t-7{width:58.3333333333%}.col-t-8{width:66.6666666667%}.col-t-9{width:75%}.col-t-10{width:83.3333333333%}.col-t-11{width:91.6666666667%}.col-t-12{width:100%}.push-t-0{margin-left:0}.push-t-1{margin-left:8.3333333333%}.push-t-2{margin-left:16.6666666667%}.push-t-3{margin-left:25%}.push-t-4{margin-left:33.3333333333%}.push-t-5{margin-left:41.6666666667%}.push-t-6{margin-left:50%}.push-t-7{margin-left:58.3333333333%}.push-t-8{margin-left:66.6666666667%}.push-t-9{margin-left:75%}.push-t-10{margin-left:83.3333333333%}.push-t-11{margin-left:91.6666666667%}.push-t-12{margin-left:100%}.pull-t-0{margin-right:0}.pull-t-1{margin-right:8.3333333333%}.pull-t-2{margin-right:16.6666666667%}.pull-t-3{margin-right:25%}.pull-t-4{margin-right:33.3333333333%}.pull-t-5{margin-right:41.6666666667%}.pull-t-6{margin-right:50%}.pull-t-7{margin-right:58.3333333333%}.pull-t-8{margin-right:66.6666666667%}.pull-t-9{margin-right:75%}.pull-t-10{margin-right:83.3333333333%}.pull-t-11{margin-right:91.6666666667%}.pull-t-12{margin-right:100%}}@media(max-width:576px){.col-m-0{width:0%}.col-m-1{width:8.3333333333%}.col-m-2{width:16.6666666667%}.col-m-3{width:25%}.col-m-4{width:33.3333333333%}.col-m-5{width:41.6666666667%}.col-m-6{width:50%}.col-m-7{width:58.3333333333%}.col-m-8{width:66.6666666667%}.col-m-9{width:75%}.col-m-10{width:83.3333333333%}.col-m-11{width:91.6666666667%}.col-m-12{width:100%}.push-m-0{margin-left:0}.push-m-1{margin-left:8.3333333333%}.push-m-2{margin-left:16.6666666667%}.push-m-3{margin-left:25%}.push-m-4{margin-left:33.3333333333%}.push-m-5{margin-left:41.6666666667%}.push-m-6{margin-left:50%}.push-m-7{margin-left:58.3333333333%}.push-m-8{margin-left:66.6666666667%}.push-m-9{margin-left:75%}.push-m-10{margin-left:83.3333333333%}.push-m-11{margin-left:91.6666666667%}.push-m-12{margin-left:100%}.pull-m-0{margin-right:0}.pull-m-1{margin-right:8.3333333333%}.pull-m-2{margin-right:16.6666666667%}.pull-m-3{margin-right:25%}.pull-m-4{margin-right:33.3333333333%}.pull-m-5{margin-right:41.6666666667%}.pull-m-6{margin-right:50%}.pull-m-7{margin-right:58.3333333333%}.pull-m-8{margin-right:66.6666666667%}.pull-m-9{margin-right:75%}.pull-m-10{margin-right:83.3333333333%}.pull-m-11{margin-right:91.6666666667%}.pull-m-12{margin-right:100%}}@media(max-width:992px){.col-d-0{width:0%}.col-d-1{width:8.3333333333%}.col-d-2{width:16.6666666667%}.col-d-3{width:25%}.col-d-4{width:33.3333333333%}.col-d-5{width:41.6666666667%}.col-d-6{width:50%}.col-d-7{width:58.3333333333%}.col-d-8{width:66.6666666667%}.col-d-9{width:75%}.col-d-10{width:83.3333333333%}.col-d-11{width:91.6666666667%}.col-d-12{width:100%}.push-d-0{margin-left:0}.push-d-1{margin-left:8.3333333333%}.push-d-2{margin-left:16.6666666667%}.push-d-3{margin-left:25%}.push-d-4{margin-left:33.3333333333%}.push-d-5{margin-left:41.6666666667%}.push-d-6{margin-left:50%}.push-d-7{margin-left:58.3333333333%}.push-d-8{margin-left:66.6666666667%}.push-d-9{margin-left:75%}.push-d-10{margin-left:83.3333333333%}.push-d-11{margin-left:91.6666666667%}.push-d-12{margin-left:100%}.pull-d-0{margin-right:0}.pull-d-1{margin-right:8.3333333333%}.pull-d-2{margin-right:16.6666666667%}.pull-d-3{margin-right:25%}.pull-d-4{margin-right:33.3333333333%}.pull-d-5{margin-right:41.6666666667%}.pull-d-6{margin-right:50%}.pull-d-7{margin-right:58.3333333333%}.pull-d-8{margin-right:66.6666666667%}.pull-d-9{margin-right:75%}.pull-d-10{margin-right:83.3333333333%}.pull-d-11{margin-right:91.6666666667%}.pull-d-12{margin-right:100%}}@media(max-width:768px){.col-t-0{width:0%}.col-t-1{width:8.3333333333%}.col-t-2{width:16.6666666667%}.col-t-3{width:25%}.col-t-4{width:33.3333333333%}.col-t-5{width:41.6666666667%}.col-t-6{width:50%}.col-t-7{width:58.3333333333%}.col-t-8{width:66.6666666667%}.col-t-9{width:75%}.col-t-10{width:83.3333333333%}.col-t-11{width:91.6666666667%}.col-t-12{width:100%}.push-t-0{margin-left:0}.push-t-1{margin-left:8.3333333333%}.push-t-2{margin-left:16.6666666667%}.push-t-3{margin-left:25%}.push-t-4{margin-left:33.3333333333%}.push-t-5{margin-left:41.6666666667%}.push-t-6{margin-left:50%}.push-t-7{margin-left:58.3333333333%}.push-t-8{margin-left:66.6666666667%}.push-t-9{margin-left:75%}.push-t-10{margin-left:83.3333333333%}.push-t-11{margin-left:91.6666666667%}.push-t-12{margin-left:100%}.pull-t-0{margin-right:0}.pull-t-1{margin-right:8.3333333333%}.pull-t-2{margin-right:16.6666666667%}.pull-t-3{margin-right:25%}.pull-t-4{margin-right:33.3333333333%}.pull-t-5{margin-right:41.6666666667%}.pull-t-6{margin-right:50%}.pull-t-7{margin-right:58.3333333333%}.pull-t-8{margin-right:66.6666666667%}.pull-t-9{margin-right:75%}.pull-t-10{margin-right:83.3333333333%}.pull-t-11{margin-right:91.6666666667%}.pull-t-12{margin-right:100%}}@media(max-width:576px){.col-m-0{width:0%}.col-m-1{width:8.3333333333%}.col-m-2{width:16.6666666667%}.col-m-3{width:25%}.col-m-4{width:33.3333333333%}.col-m-5{width:41.6666666667%}.col-m-6{width:50%}.col-m-7{width:58.3333333333%}.col-m-8{width:66.6666666667%}.col-m-9{width:75%}.col-m-10{width:83.3333333333%}.col-m-11{width:91.6666666667%}.col-m-12{width:100%}.push-m-0{margin-left:0}.push-m-1{margin-left:8.3333333333%}.push-m-2{margin-left:16.6666666667%}.push-m-3{margin-left:25%}.push-m-4{margin-left:33.3333333333%}.push-m-5{margin-left:41.6666666667%}.push-m-6{margin-left:50%}.push-m-7{margin-left:58.3333333333%}.push-m-8{margin-left:66.6666666667%}.push-m-9{margin-left:75%}.push-m-10{margin-left:83.3333333333%}.push-m-11{margin-left:91.6666666667%}.push-m-12{margin-left:100%}.pull-m-0{margin-right:0}.pull-m-1{margin-right:8.3333333333%}.pull-m-2{margin-right:16.6666666667%}.pull-m-3{margin-right:25%}.pull-m-4{margin-right:33.3333333333%}.pull-m-5{margin-right:41.6666666667%}.pull-m-6{margin-right:50%}.pull-m-7{margin-right:58.3333333333%}.pull-m-8{margin-right:66.6666666667%}.pull-m-9{margin-right:75%}.pull-m-10{margin-right:83.3333333333%}.pull-m-11{margin-right:91.6666666667%}.pull-m-12{margin-right:100%}}@media(max-width:992px){.col-d-0{width:0%}.col-d-1{width:8.3333333333%}.col-d-2{width:16.6666666667%}.col-d-3{width:25%}.col-d-4{width:33.3333333333%}.col-d-5{width:41.6666666667%}.col-d-6{width:50%}.col-d-7{width:58.3333333333%}.col-d-8{width:66.6666666667%}.col-d-9{width:75%}.col-d-10{width:83.3333333333%}.col-d-11{width:91.6666666667%}.col-d-12{width:100%}.push-d-0{margin-left:0}.push-d-1{margin-left:8.3333333333%}.push-d-2{margin-left:16.6666666667%}.push-d-3{margin-left:25%}.push-d-4{margin-left:33.3333333333%}.push-d-5{margin-left:41.6666666667%}.push-d-6{margin-left:50%}.push-d-7{margin-left:58.3333333333%}.push-d-8{margin-left:66.6666666667%}.push-d-9{margin-left:75%}.push-d-10{margin-left:83.3333333333%}.push-d-11{margin-left:91.6666666667%}.push-d-12{margin-left:100%}.pull-d-0{margin-right:0}.pull-d-1{margin-right:8.3333333333%}.pull-d-2{margin-right:16.6666666667%}.pull-d-3{margin-right:25%}.pull-d-4{margin-right:33.3333333333%}.pull-d-5{margin-right:41.6666666667%}.pull-d-6{margin-right:50%}.pull-d-7{margin-right:58.3333333333%}.pull-d-8{margin-right:66.6666666667%}.pull-d-9{margin-right:75%}.pull-d-10{margin-right:83.3333333333%}.pull-d-11{margin-right:91.6666666667%}.pull-d-12{margin-right:100%}}@media(max-width:768px){.col-t-0{width:0%}.col-t-1{width:8.3333333333%}.col-t-2{width:16.6666666667%}.col-t-3{width:25%}.col-t-4{width:33.3333333333%}.col-t-5{width:41.6666666667%}.col-t-6{width:50%}.col-t-7{width:58.3333333333%}.col-t-8{width:66.6666666667%}.col-t-9{width:75%}.col-t-10{width:83.3333333333%}.col-t-11{width:91.6666666667%}.col-t-12{width:100%}.push-t-0{margin-left:0}.push-t-1{margin-left:8.3333333333%}.push-t-2{margin-left:16.6666666667%}.push-t-3{margin-left:25%}.push-t-4{margin-left:33.3333333333%}.push-t-5{margin-left:41.6666666667%}.push-t-6{margin-left:50%}.push-t-7{margin-left:58.3333333333%}.push-t-8{margin-left:66.6666666667%}.push-t-9{margin-left:75%}.push-t-10{margin-left:83.3333333333%}.push-t-11{margin-left:91.6666666667%}.push-t-12{margin-left:100%}.pull-t-0{margin-right:0}.pull-t-1{margin-right:8.3333333333%}.pull-t-2{margin-right:16.6666666667%}.pull-t-3{margin-right:25%}.pull-t-4{margin-right:33.3333333333%}.pull-t-5{margin-right:41.6666666667%}.pull-t-6{margin-right:50%}.pull-t-7{margin-right:58.3333333333%}.pull-t-8{margin-right:66.6666666667%}.pull-t-9{margin-right:75%}.pull-t-10{margin-right:83.3333333333%}.pull-t-11{margin-right:91.6666666667%}.pull-t-12{margin-right:100%}}@media(max-width:576px){.col-m-0{width:0%}.col-m-1{width:8.3333333333%}.col-m-2{width:16.6666666667%}.col-m-3{width:25%}.col-m-4{width:33.3333333333%}.col-m-5{width:41.6666666667%}.col-m-6{width:50%}.col-m-7{width:58.3333333333%}.col-m-8{width:66.6666666667%}.col-m-9{width:75%}.col-m-10{width:83.3333333333%}.col-m-11{width:91.6666666667%}.col-m-12{width:100%}.push-m-0{margin-left:0}.push-m-1{margin-left:8.3333333333%}.push-m-2{margin-left:16.6666666667%}.push-m-3{margin-left:25%}.push-m-4{margin-left:33.3333333333%}.push-m-5{margin-left:41.6666666667%}.push-m-6{margin-left:50%}.push-m-7{margin-left:58.3333333333%}.push-m-8{margin-left:66.6666666667%}.push-m-9{margin-left:75%}.push-m-10{margin-left:83.3333333333%}.push-m-11{margin-left:91.6666666667%}.push-m-12{margin-left:100%}.pull-m-0{margin-right:0}.pull-m-1{margin-right:8.3333333333%}.pull-m-2{margin-right:16.6666666667%}.pull-m-3{margin-right:25%}.pull-m-4{margin-right:33.3333333333%}.pull-m-5{margin-right:41.6666666667%}.pull-m-6{margin-right:50%}.pull-m-7{margin-right:58.3333333333%}.pull-m-8{margin-right:66.6666666667%}.pull-m-9{margin-right:75%}.pull-m-10{margin-right:83.3333333333%}.pull-m-11{margin-right:91.6666666667%}.pull-m-12{margin-right:100%}}img[data-action=zoom]{cursor:pointer;cursor:-webkit-zoom-in;cursor:-moz-zoom-in}.zoom-img,.zoom-img-wrap{position:relative;z-index:666;-webkit-transition:all .3s;-o-transition:all .3s;transition:all .3s}img.zoom-img{cursor:pointer;cursor:-webkit-zoom-out;cursor:-moz-zoom-out}.zoom-overlay{z-index:420;background:#16151f;position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;opacity:0;-webkit-transition:opacity .3s;-o-transition:opacity .3s;transition:opacity .3s}@supports(-webkit-backdrop-filter:none) or (backdrop-filter:none){.zoom-overlay{-webkit-backdrop-filter:saturate(180%) blur(10px);backdrop-filter:saturate(180%) blur(10px);background:rgba(22,21,31,.8)}}.zoom-overlay-open .zoom-overlay{opacity:1}.zoom-overlay-open,.zoom-overlay-transitioning{cursor:default}.animate{animation:animateElement cubic-bezier(.3,.45,.45,.95) .75s;animation-duration:.75s;animation-iteration-count:1;transition:transform .2s}@keyframes animateElement{0%{opacity:0;transform:translate(0,50px)}100%{opacity:1;transform:translate(0,0)}}*,::after,::before{box-sizing:border-box}body{font-family:"Josefin Sans",sans-serif;font-size:18px;line-height:1.7;color:#fff;background-color:#16151f;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overflow-x:hidden}body.is-in::after{visibility:hidden;opacity:0;pointer-events:none}body::after{content:"";position:fixed;left:0;top:0;width:100%;height:100%;background-color:#0a0a12;z-index:15;transition:1s}body input,body textarea{border:1px solid #c6c6c6;outline:0}@media only screen and (max-width:576px){body{font-size:16px;line-height:29px}}::placeholder{color:#757575}::selection{color:#fff;background-color:rgba(50,58,150,.7)}h1,h2,h3,h4,h5,h6{font-family:Poppins,Arial,sans-serif;font-weight:700;line-height:1.4em;color:#fff}h1{font-size:36px}h2{font-size:28px}h3{font-size:24px}h4{font-size:20px}h5{font-size:18px}h6{font-size:16px}blockquote{position:relative;padding:20px 20px 20px 45px;font-family:Poppins,Arial,sans-serif;font-size:21px;line-height:37px;font-weight:700;color:#fff}blockquote:before{content:"“";position:absolute;font-family:Poppins,Arial,sans-serif;top:.3em;left:-.01em;font-size:4em;color:rgba(255,255,255,.6)}blockquote cite{font-size:16px;font-style:normal;color:#fff}blockquote cite:before{content:"—" " "}@media only screen and (max-width:576px){blockquote{padding:20px 20px 20px 35px;font-size:18px;line-height:28px}}pre{overflow:auto;padding:15px;font-size:14px;white-space:pre-wrap;word-wrap:break-word;word-break:break-all}code[class*=language-],pre[class*=language-]{white-space:pre-wrap;word-break:break-all;line-height:inherit}.zoom-img-wrap,img{max-width:100%;height:auto;vertical-align:middle}.zoom-img-wrap+em,img+em{display:inline-block;width:100%;padding:13px;font-size:14px;font-style:normal;line-height:1;text-align:center;color:rgba(255,255,255,.8);background-color:#0a0a12}a{text-decoration:none;color:#fff;transition:all .2s}a:hover{color:#323a96}hr{display:block;width:100%;height:1px;margin:50px 0;border:0;background:rgba(255,255,255,.1)}.table-container{display:block;max-width:100%;overflow-x:auto}table{font-size:12px;color:rgba(255,255,255,.6);width:100%;border-width:1px;border-color:#0a0a12;border-collapse:collapse}table th{padding:10px;font-size:16px;text-align:left;border:1px solid #0a0a12;color:#fff;background-color:#323a96}table tr{background-color:#0a0a12;transition:all .3s ease}table tr:nth-child(even){background-color:rgba(0,0,0,0)}table td{padding:10px;font-size:14px;border:1px solid #0a0a12}table tr:hover{color:#fff}.gallery-box{margin-bottom:30px}.gallery-box em{display:inline-block;width:100%;padding:13px;font-size:14px;font-style:normal;line-height:1;text-align:center;color:rgba(255,255,255,.8);background-color:#0a0a12}.gallery-box em a{text-decoration:underline;border-bottom:none}.gallery{display:grid;grid-template-columns:repeat(3,auto);justify-content:center;align-content:center;grid-gap:10px}.gallery img{width:100%;height:auto}.hero{position:relative;margin-bottom:30px;border-radius:30px;overflow:hidden;box-shadow:0 5px 10px 0 rgba(0,0,0,.15);background-color:#0a0a12}@media only screen and (max-width:992px){.hero{border-radius:30px}}@media only screen and (max-width:576px){.hero{box-shadow:none}}.hero__inner::before{content:"";display:block;position:absolute;top:0;bottom:0;left:0;right:0;z-index:1;border-radius:30px;background-color:rgba(16,17,30,.6)}@media only screen and (max-width:992px){.hero__inner::before{border-radius:30px}}.hero__image{padding-top:25%;min-height:280px;user-select:none;filter:blur(2px);-webkit-filter:blur(2px)}.hero__image img{position:absolute;top:0;width:100%;height:100%;object-fit:cover}@media only screen and (max-width:992px){.hero__image{min-height:200px}}@media only screen and (max-width:768px){.hero__image{min-height:150px}}.hero__content{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1;width:100%;max-width:650px;padding:0 20px;text-align:center}.hero__title{font-size:57px;margin:0 0 10px;color:#fff}@media only screen and (max-width:576px){.hero__title{font-size:43px;margin:0 0 5px}}.hero__desc{font-size:18px;color:rgba(255,255,255,.8);margin:0}@media only screen and (max-width:576px){.hero__desc{font-size:15px;line-height:21px}}.hero-without-image{margin:50px 0 80px}.hero-without-image .hero-inner{display:flex;align-items:center;justify-content:center}.hero-without-image .hero-content{width:100%;max-width:650px;padding:0 20px;text-align:center}@media only screen and (max-width:576px){.hero-without-image{margin:20px 0 50px}}.top{position:fixed;bottom:25px;right:-100px;z-index:5;width:40px;height:40px;line-height:40px;text-align:center;border-radius:5px;background-color:#0a0a12;color:#fff;cursor:pointer;transition:all .25s ease}.top.is-active{right:30px}@media only screen and (max-width:768px){.top{bottom:15px}.top.is-active{right:25px}}.header{width:100%;margin:35px 0;transition:all .2s;color:#fff}@media only screen and (max-width:992px){.header{margin:25px 0}}.header__inner{position:relative;display:flex;justify-content:space-between;align-items:center}.logo__link{font-family:Poppins,Arial,sans-serif;font-size:27px;line-height:1;font-weight:700;vertical-align:middle;color:#fff;text-decoration:none;letter-spacing:2px;transition:none}.logo__link:hover{color:#fff}.logo__image{max-height:46px;margin-top:-4px}@media only screen and (max-width:768px){.logo__image{display:none}}.main-nav{width:100%;max-width:1300px;margin:0 auto}.main-nav__box{display:flex;align-items:center;width:80%;padding-top:200px;margin:0 auto}.main-nav__box .nav__icon-close{position:absolute;top:20px;right:40px;z-index:5;display:flex;align-items:center;justify-content:center;font-size:30px;width:40px;height:40px;text-align:center;line-height:40px;color:rgba(255,255,255,.5);transition:all .25s ease;cursor:pointer}.main-nav__box .nav__icon-close:hover{color:#fff}@media only screen and (max-width:768px){.main-nav__box{padding-top:100px}.main-nav__box .nav__icon-close{top:22px;right:42px}}@media only screen and (max-width:576px){.main-nav__box{width:90%}}.navigation{display:flex;align-items:center}.top-nav{margin-right:25px}.top-nav .nav__list .nav__item{display:inline-block;margin-right:25px}.top-nav .nav__list .nav__item:last-child{margin-right:0}.top-nav .nav__list .nav__item .nav__link{position:relative;font-size:16px;font-weight:400;text-decoration:none;color:#fff}.top-nav .nav__list .nav__item .nav__link:hover::before{opacity:1;visibility:visible}.top-nav .nav__list .nav__item .nav__link::before{content:"";position:absolute;left:50%;top:-15px;transform:translateX(-50%);display:block;width:7px;height:7px;border-radius:50%;transition:all .25s;opacity:0;visibility:hidden;background-color:#323a96}@media only screen and (max-width:992px){.top-nav{display:none}}.mobile-nav .nav__list .nav__item{display:block;margin-bottom:35px;text-align:center}.mobile-nav .nav__list .nav__item:last-child{margin-bottom:0}.mobile-nav .nav__list .nav__item .nav__link{position:relative;font-size:18px;color:#fff}@media only screen and (max-width:576px){.mobile-nav .nav__list .nav__item{margin-bottom:20px}}.nav-buttons{display:flex;align-items:center;font-size:24px;color:#fff}.nav-buttons .nav__icon-menu{display:none}@media only screen and (max-width:992px){.nav-buttons .nav__icon-menu{display:block}}.nav-buttons .nav__icon{cursor:pointer}.nav-buttons .nav__icon:first-child{margin-right:15px}.menu-overlay{position:fixed;top:0;left:0;right:0;bottom:0;z-index:100;opacity:0;visibility:hidden;background-color:#0a0a12;transition:all .5s ease-in-out}.menu-overlay.is-open{opacity:1;visibility:visible}@supports(-webkit-backdrop-filter:none) or (backdrop-filter:none){.menu-overlay{-webkit-backdrop-filter:saturate(180%) blur(10px);backdrop-filter:saturate(180%) blur(10px);background-color:rgba(10,10,18,.9)}}@media only screen and (min-width:992px){.menu-overlay{display:none}}.nav-grid{width:100%;height:75vh;overflow-y:auto}.nav-grid__item{margin-bottom:30px}@media only screen and (max-width:768px){.nav-grid__item{height:auto}}.nav-grid__title{position:relative;margin-bottom:50px;padding-bottom:15px;font-size:30px;font-weight:700;text-align:center;color:#fff}.nav-grid__title::after{content:"";position:absolute;left:50%;bottom:0;transform:translate(-50%,-50%);display:block;width:25px;height:2px;background-color:#fff}@media only screen and (max-width:768px){.nav-grid__title{margin-bottom:30px}}.search{position:fixed;top:0;left:0;right:0;bottom:0;z-index:100;opacity:0;visibility:hidden;background-color:#0a0a12;transition:all .5s ease-in-out}.search.is-visible{opacity:1;visibility:visible}@supports(-webkit-backdrop-filter:none) or (backdrop-filter:none){.search{-webkit-backdrop-filter:saturate(180%) blur(10px);backdrop-filter:saturate(180%) blur(10px);background-color:rgba(10,10,18,.9)}}.search__box{position:relative;max-width:650px;width:100%;margin:0 auto;padding-top:200px}.search__box .search__close{position:absolute;right:0;top:175px;font-size:30px;line-height:1;color:rgba(255,255,255,.5);transition:all .25s;cursor:pointer}.search__box .search__close:hover{color:#fff}@media only screen and (max-width:768px){.search__box .search__close{top:75px}}@media only screen and (max-width:768px){.search__box{width:80%;padding-top:100px}}@media only screen and (max-width:576px){.search__box{width:90%}}.search__group{position:relative;margin-bottom:30px}.search__group .search__text{width:100%;height:auto;padding:0 20px 12px 0;font-family:Poppins,Arial,sans-serif;font-size:30px;font-weight:700;line-height:1;border:0;border-bottom:5px solid rgba(255,255,255,.5);color:#fff;background-color:rgba(0,0,0,0)}.search__group .search__text::-webkit-input-placeholder{font-weight:700;color:rgba(255,255,255,.5)}.search__group .search__text::placeholder{font-weight:700;color:rgba(255,255,255,.5)}.search__group .search__text::-ms-clear{display:none}@media only screen and (max-width:576px){.search__group .search__text{font-size:30px}}.search__group .search__text:focus{color:#fff;border-bottom-color:#323a96}.search-results-list{height:55vh;padding:0 0 25px 0;list-style:circle;font-weight:700;color:#fff;overflow:auto;white-space:normal}.search-results-list .search-results__item{padding-bottom:15px;margin-bottom:15px;display:list-item;list-style-type:none;border-bottom:1px solid rgba(255,255,255,.1)}.search-results-list .search-results__link{position:relative;display:block;margin-left:-15px;padding-left:20px;font-size:18px;line-height:24px;font-weight:700;color:#fff;transition:all .25s ease-in-out}.search-results-list .search-results__link:hover{margin-left:15px}.search-results-list .search-results__link::before{content:"";position:absolute;top:6px;left:0;width:7px;height:7px;border-radius:50%;border:1px solid #fff}.search-results-list .search-results-date{font-size:12px;line-height:1;font-weight:400;color:rgba(255,255,255,.6)}.search-results-list .no-results{margin-left:-10px;list-style:none}.search-results-list .no-results h3{font-size:18px}.load-more{margin:0 auto}.load-more-section{margin:30px auto;text-align:center}@media only screen and (max-width:576px){.load-more-section{margin:20px auto}}.load-more-posts i{margin-left:5px}.footer-widgets{padding:80px 0 30px;margin-top:20px;background-color:#0a0a12}.footer-widgets .row .col{flex-grow:1}.footer-widgets .row .col:last-child>.widget{padding-right:0}@media only screen and (max-width:768px){.footer-widgets{padding:80px 0 0}}@media only screen and (max-width:576px){.footer-widgets{padding:50px 0 0}}@media only screen and (max-width:768px){.widget{margin-bottom:60px}}.widget__title{position:relative;margin-bottom:20px;font-size:30px;line-height:1;color:#fff}@media only screen and (max-width:992px){.widget__title{font-size:24px}}.footer-logo{margin-bottom:20px;font-family:Poppins,Arial,sans-serif;font-size:27px;line-height:33px;font-weight:700;color:#fff;text-transform:uppercase;letter-spacing:2px;transition:none}.footer-desc{margin-bottom:0;font-size:16px;line-height:24px;color:rgba(255,255,255,.6)}.widget-nav{padding-right:30px}.widget-nav .nav__item{margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,.1)}.widget-nav .nav__item:last-child{margin-bottom:0}.widget-nav .nav__link{font-size:16px;color:#fff}@media only screen and (max-width:992px){.widget-nav{padding-right:0}}@media only screen and (max-width:768px){.widget-subscribe{margin-bottom:0}}.subscribe-subtitle{width:100%;margin-bottom:20px;font-size:16px;line-height:26px;color:rgba(255,255,255,.6)}@media only screen and (max-width:768px){.subscribe-subtitle{max-width:100%}}.subscribe-group-top{display:flex;align-items:center}.subscribe-group-top .subscribe-email{position:relative;width:100%;height:50px;padding:8px 15px;font-family:Poppins,Arial,sans-serif;font-size:13px;border-radius:5px;line-height:50px;color:#0a0a12;background-color:#fff;border:1px solid #c6c6c6;outline:0;-webkit-appearance:none;box-sizing:border-box;transition:border-color .2s ease-in-out;cursor:text}.subscribe-group-top .subscribe-button{margin-left:10px}.footer{position:relative;padding:50px 0;background-color:#0a0a12}.footer .footer__inner{display:flex;justify-content:space-between;align-items:center}@media only screen and (max-width:992px){.footer .footer__inner{flex-direction:column}}.copyright{font-size:13px;text-align:center;color:rgba(255,255,255,.6)}.copyright a{color:#fff}.social{text-align:center}.social .social__list{display:flex;flex-wrap:wrap;justify-content:center;align-items:center}.social .social__item{display:inline-block;margin-left:10px}.social .social__item:first-child{margin-left:0}.social .social__link{display:flex;justify-content:center;align-items:center;width:40px;height:40px;font-size:18px;line-height:40px;border-radius:3px;color:#fff;background-color:#16151f}.social .social__link:hover{background-color:#323a96}@media only screen and (max-width:992px){.social{margin-bottom:5px}.social .social__item{margin-bottom:10px}.social .social__link{width:30px;height:30px;line-height:30px;font-size:16px}}.button{display:inline-block;white-space:nowrap;vertical-align:middle;font:inherit;border:none;border-radius:5px;outline:0;-webkit-appearance:none;text-align:center;text-decoration:none;color:#fff;transition:all .2s ease;cursor:pointer}.button:hover{color:#fff}.button--primary{padding:0 1.8rem;height:50px;font-size:16px;font-weight:600;line-height:50px;background-color:#323a96}.button--primary:hover{background-color:#2c3383}.button--middle{position:relative;height:60px;width:100%;max-width:280px;font-family:Poppins,Arial,sans-serif;font-size:12px;line-height:60px;font-weight:600;letter-spacing:1px;text-transform:uppercase;transition:all .2s ease;background-color:#0a0a12}.button--middle:hover{background-color:#08080f}.button--small{height:28px;line-height:28px;display:inline-block;border-radius:30px;padding:0 15px;color:#fff;background-color:#323a96}.button--small:hover{background-color:#2c3383}.button--small::before{content:none!important}.button--big{display:block;width:100%}.article{align-items:stretch;flex-grow:1;min-height:285px;margin-bottom:30px}.article:hover{transform:translateY(-5px)}@media only screen and (max-width:576px){.article{min-height:280px}}.article__inner{position:relative;display:flex;width:100%;height:100%;border-radius:30px;overflow:hidden;box-shadow:0 5px 10px 0 rgba(0,0,0,.15);background-color:#0a0a12}.article__inner .featured-post{position:absolute;top:0;right:0;z-index:10;width:35px;height:35px;display:flex;justify-content:center;align-items:center;font-size:18px;color:rgba(255,255,255,.8);user-select:none}.article__inner .featured-post::before{content:"";position:absolute;top:0;right:0;width:100%;height:100%;border-color:#323a96 #323a96 transparent transparent;border-style:solid;border-width:29px}.article__inner .featured-post i{position:relative}.article__title{margin:10px 0 15px;font-size:21px}.article__title a{color:#fff}@media only screen and (max-width:576px){.article__title{margin:5px 0 10px;font-size:18px}}.article__excerpt{margin-bottom:15px;font-size:15px;color:rgba(255,255,255,.6)}@media only screen and (max-width:576px){.article__excerpt{margin-bottom:10px;font-size:13px;line-height:21px}}.article__image{position:absolute;display:block;width:100%;height:100%;overflow:hidden;user-select:none;background-color:#0a0a12}.article__image::after{content:"";display:block;position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(16,17,30,.6);pointer-events:none;filter:blur(2px);-webkit-filter:blur(2px)}.article__image img{position:absolute;top:0;width:100%;height:100%;object-fit:cover;pointer-events:none;filter:blur(2px);-webkit-filter:blur(2px)}@media only screen and (max-width:768px){.article__image{padding-top:75%}}@media only screen and (max-width:576px){.article__image{padding-top:80%}}.article__content{z-index:1;width:100%;margin-top:auto;padding:0 30px 30px}@media only screen and (max-width:576px){.article__content{padding:20px}}.article__meta{display:flex;align-items:center;flex-wrap:wrap;justify-content:flex-start;color:#fff}.article-tags{display:flex;flex-wrap:wrap;align-items:center}.article-tags__box{position:relative;display:flex;flex-wrap:wrap;align-items:center;line-height:1}.article-tags__box .article__tag{height:23px;padding:0 10px;margin:0 5px 5px 0;text-transform:uppercase;font-family:Poppins,Arial,sans-serif;font-size:10px;line-height:23px;letter-spacing:1px;font-weight:700;border-radius:30px;color:rgba(255,255,255,.9);background-color:#323a96}.article-tags__box .article__tag:hover{background-color:#2c3383}.article-tags__box .article__tag:last-child{margin-right:0}@media only screen and (max-width:576px){.article-tags__box .article__tag{height:20px;line-height:20px}}.article__date{font-size:14px;color:#fff}@media only screen and (max-width:576px){.article__date{display:none}}.article__author{display:flex;align-items:center}.article__author-image{display:inline-block;width:25px;height:25px;margin-right:7px;border-radius:50%;border:1px solid rgba(255,255,255,.6);background-size:cover;background-position:center;background-repeat:no-repeat;background-color:#0a0a12}.article__author-link{font-size:14px;text-decoration:underline;color:#fff}.article__author-link:hover{color:#fff}.article__author span{color:rgba(255,255,255,.8)}.post{position:relative;margin-bottom:30px}.post-image{position:absolute;top:0;width:100%;height:100%;object-fit:cover;user-select:none;filter:blur(4px);-webkit-filter:blur(4px)}.image-box{position:relative;padding-top:50%;min-height:280px;border-radius:30px;overflow:hidden;box-shadow:0 5px 10px 0 rgba(0,0,0,.15);background-color:#0a0a12}@media only screen and (max-width:992px){.image-box{padding-top:55%}}@media only screen and (max-width:768px){.image-box{padding-top:65%}}.post-tags{position:relative;display:flex;justify-content:center;flex-wrap:wrap}.post-tags .post-tags__tag{height:23px;margin-right:5px;margin-bottom:5px;padding:0 10px;text-transform:uppercase;font-family:Poppins,Arial,sans-serif;font-size:10px;line-height:23px;letter-spacing:1px;font-weight:700;border-radius:30px;color:rgba(255,255,255,.9);background-color:#323a96}.post-tags .post-tags__tag:hover{background-color:#2c3383}.post-tags .post-tags__tag:last-child{margin-right:0}@media only screen and (max-width:576px){.post-tags .post-tags__tag{height:20px;line-height:20px}}.post-head{margin:40px 0}.post-title{font-size:43px;margin:10px 0 15px;text-align:center}@media only screen and (max-width:768px){.post-title{font-size:38px}}@media only screen and (max-width:576px){.post-title{font-size:28px}}.post__meta{display:flex;align-items:center;flex-wrap:wrap;justify-content:center;color:#fff}.post__author{display:flex;align-items:center}.post__author-image{display:inline-block;width:25px;height:25px;margin-right:7px;border-radius:50%;border:1px solid rgba(255,255,255,.6);background-size:cover;background-position:center;background-repeat:no-repeat;background-color:#0a0a12}.post__author-link{font-size:14px;text-decoration:underline;color:#fff}.post__author-link:hover{color:#fff}.post__author span{color:rgba(255,255,255,.8)}.post__date{font-size:14px;color:#fff}.post__content{color:rgba(255,255,255,.6)}.post__content a:hover{color:#fff;text-decoration:underline}.post-full-content .post-content p{text-align:center;color:rgba(255,255,255,.8)}.post-full-content .post-upgrade-cta-content{padding:80px 20px;text-align:center;border-radius:5px;overflow:hidden;box-shadow:0 5px 10px 0 rgba(0,0,0,.15);background-color:#0a0a12}.post-full-content .post-upgrade-cta-content h2{font-size:27px}.post-full-content .post-upgrade-cta-content .signin__bottom-text{margin-top:10px}@media only screen and (max-width:576px){.post-full-content .post-upgrade-cta-content{padding:60px 20px}.post-full-content .post-upgrade-cta-content h2{font-size:24px;margin-bottom:20px}}.post__share{margin-bottom:80px}.post__share .share__head{text-align:center}.post__share .share__title{position:relative;display:inline-block;margin-bottom:25px;font-family:Poppins,Arial,sans-serif;font-size:15px;font-weight:700;letter-spacing:1px;text-align:center;text-transform:uppercase}.post__share .share__list{display:flex;justify-content:center;align-items:center;width:100%}.post__share .share__item{margin:0 5px;text-align:center}.post__share .share__link{display:flex;justify-content:center;align-items:center;width:30px;height:30px;line-height:30px;border-radius:50%;font-size:16px;color:#0a0a12;background-color:#fff;transition:all .2s}.post__share .share__link:hover.share__facebook{color:#3b5998}.post__share .share__link:hover.share__twitter{color:#55acee}.post__share .share__link:hover.share__linkedin{color:#0077b5}.post__share .share__link:hover.share__pinterest{color:#bd081c}@media only screen and (max-width:576px){.post__share{margin-bottom:50px}}.post__navigation{display:flex;justify-content:space-between;margin-bottom:50px}.post__navigation a:first-child{margin-right:4%}.post__navigation a:last-child{margin-right:0}.post__navigation .next,.post__navigation .prev{position:relative;display:flex;align-items:flex-end;width:100%;min-height:230px;padding:0 25px 25px;border-radius:30px;overflow:hidden;transition:transform .2s,-webkit-transform .2s;box-shadow:0 5px 10px 0 rgba(0,0,0,.15);background-size:cover;background-position:center;background-repeat:no-repeat;background-color:#0a0a12}.post__navigation .next::after,.post__navigation .prev::after{content:"";display:block;position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(16,17,30,.6);pointer-events:none}.post__navigation .next:hover,.post__navigation .prev:hover{transform:translateY(-5px)}.post__navigation .next img,.post__navigation .prev img{position:absolute;display:block;width:100%;height:100%;overflow:hidden;user-select:none;object-fit:cover;margin-left:-25px;border-top-width:0;border-top-style:solid;margin-bottom:-25px;filter:blur(2px);-webkit-filter:blur(2px)}.post__navigation .next .post__nav,.post__navigation .prev .post__nav{display:inline-block;margin-bottom:5px;font-size:13px;font-family:Poppins,Arial,sans-serif;letter-spacing:1px;text-transform:uppercase;color:rgba(255,255,255,.8)}.post__navigation .next .post__nav-box,.post__navigation .prev .post__nav-box{position:relative;z-index:1;width:100%}.post__navigation .next .post__nav__title,.post__navigation .prev .post__nav__title{margin-bottom:0;font-size:21px}.post__navigation .next .post__nav__title a,.post__navigation .prev .post__nav__title a{color:#fff}.post__navigation .next::after,.post__navigation .prev::after{filter:blur(2px);-webkit-filter:blur(2px)}.post__navigation .next{text-align:right;margin-left:auto}@media only screen and (max-width:768px){.post__navigation{flex-wrap:wrap}.post__navigation .next,.post__navigation .prev{width:100%}.post__navigation .prev{margin-bottom:20px}}.comments__article{margin-bottom:20px}.page{position:relative;margin-bottom:30px}.page-title{font-size:43px;margin-bottom:20px;text-align:center}@media only screen and (max-width:768px){.page-title{font-size:38px}}@media only screen and (max-width:768px){.page-title{font-size:28px}}.page-image{position:absolute;top:0;width:100%;height:100%;object-fit:cover;user-select:none}.image-box{position:relative;padding-top:20%;border-radius:30px;overflow:hidden;background-color:#0a0a12}@media only screen and (max-width:992px){.image-box{padding-top:55%}}@media only screen and (max-width:768px){.image-box{padding-top:65%}}.image-box::after{content:"";display:block;position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(16,17,30,.6);pointer-events:none;filter:blur(4px);-webkit-filter:blur(4px)}.page-head{margin:40px 0}.page__content{color:rgba(255,255,255,.6)}.page__content a:hover{color:#fff;text-decoration:underline}.archive-box{position:relative;margin:50px 0 80px;text-align:center}@media only screen and (max-width:576px){.archive-box{margin:20px 0 50px}}.archive-meta{font-size:16px;color:rgba(255,255,255,.6)}.archive-title{position:relative;margin:0;font-size:47px;line-height:57px}@media only screen and (max-width:576px){.archive-title{font-size:40px;line-height:52px}}.archive-description{max-width:600px;margin:10px auto 0;font-size:16px;line-height:32px}@media only screen and (max-width:576px){.archive-description{margin:5px auto 0;line-height:28px}}.form__group{margin-bottom:20px}.form__label{display:inline-block;margin-bottom:5px;font-family:Poppins,Arial,sans-serif;font-size:14px;font-weight:600}.form__input{width:100%;padding:15px;font-family:Poppins,Arial,sans-serif;font-size:14px;border-radius:5px}.article__tag__platform{background-color:#dccea4!important;color:#000!important}.article__tag__pipelines{background-color:#434f4e!important;color:#fff!important}.article__tag__automation{background-color:#e1d5b1!important;color:#000!important}.article__tag__testing{background-color:#ede7d2!important;color:#000!important}.article__tag__infrastructure{background-color:#f7f5ec!important;color:#000!important}.article__tag__web{background-color:#e3d9b8!important;color:#000!important}.article__tag__smartwatch{background-color:#677977!important;color:#000!important}.article__tag__speech{background-color:#9cacaa!important;color:#000!important}.article__tag__life{background-color:#c1c7cb!important;color:#000!important}.article__tag__events{background-color:#acacd1!important;color:#000!important}.article__tag__projects{background-color:#e0e3e5!important;color:#000!important}.article__tag__development{background-color:#6e6eaf!important;color:#000!important}.article__tag__android{background-color:#cfd3d6!important;color:#000!important}@font-face{font-family:"Josefin Sans";font-style:normal;font-weight:400;src:url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-regular.eot);src:local(""),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-regular.eot?#iefix) format("embedded-opentype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-regular.woff2) format("woff2"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-regular.woff) format("woff"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-regular.ttf) format("truetype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-regular.svg#JosefinSans) format("svg")}@font-face{font-family:"Josefin Sans";font-style:normal;font-weight:600;src:url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600.eot);src:local(""),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600.eot?#iefix) format("embedded-opentype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600.woff2) format("woff2"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600.woff) format("woff"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600.ttf) format("truetype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600.svg#JosefinSans) format("svg")}@font-face{font-family:"Josefin Sans";font-style:normal;font-weight:700;src:url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700.eot);src:local(""),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700.eot?#iefix) format("embedded-opentype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700.woff2) format("woff2"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700.woff) format("woff"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700.ttf) format("truetype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700.svg#JosefinSans) format("svg")}@font-face{font-family:"Josefin Sans";font-style:italic;font-weight:400;src:url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-italic.eot);src:local(""),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-italic.eot?#iefix) format("embedded-opentype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-italic.woff2) format("woff2"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-italic.woff) format("woff"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-italic.ttf) format("truetype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-italic.svg#JosefinSans) format("svg")}@font-face{font-family:"Josefin Sans";font-style:italic;font-weight:700;src:url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700italic.eot);src:local(""),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700italic.eot?#iefix) format("embedded-opentype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700italic.woff2) format("woff2"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700italic.woff) format("woff"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700italic.ttf) format("truetype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-700italic.svg#JosefinSans) format("svg")}@font-face{font-family:"Josefin Sans";font-style:italic;font-weight:600;src:url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600italic.eot);src:local(""),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600italic.eot?#iefix) format("embedded-opentype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600italic.woff2) format("woff2"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600italic.woff) format("woff"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600italic.ttf) format("truetype"),url(/fonts/josefin-sans-v20-vietnamese_latin-ext_latin-600italic.svg#JosefinSans) format("svg")}@font-face{font-family:Poppins;font-style:normal;font-weight:400;src:url(/fonts/poppins-v15-latin-ext_latin_devanagari-regular.eot);src:local(""),url(/fonts/poppins-v15-latin-ext_latin_devanagari-regular.eot?#iefix) format("embedded-opentype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-regular.woff2) format("woff2"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-regular.woff) format("woff"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-regular.ttf) format("truetype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-regular.svg#Poppins) format("svg")}@font-face{font-family:Poppins;font-style:italic;font-weight:400;src:url(/fonts/poppins-v15-latin-ext_latin_devanagari-italic.eot);src:local(""),url(/fonts/poppins-v15-latin-ext_latin_devanagari-italic.eot?#iefix) format("embedded-opentype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-italic.woff2) format("woff2"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-italic.woff) format("woff"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-italic.ttf) format("truetype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-italic.svg#Poppins) format("svg")}@font-face{font-family:Poppins;font-style:normal;font-weight:600;src:url(/fonts/poppins-v15-latin-ext_latin_devanagari-600.eot);src:local(""),url(/fonts/poppins-v15-latin-ext_latin_devanagari-600.eot?#iefix) format("embedded-opentype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-600.woff2) format("woff2"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-600.woff) format("woff"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-600.ttf) format("truetype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-600.svg#Poppins) format("svg")}@font-face{font-family:Poppins;font-style:italic;font-weight:600;src:url(/fonts/poppins-v15-latin-ext_latin_devanagari-600italic.eot);src:local(""),url(/fonts/poppins-v15-latin-ext_latin_devanagari-600italic.eot?#iefix) format("embedded-opentype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-600italic.woff2) format("woff2"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-600italic.woff) format("woff"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-600italic.ttf) format("truetype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-600italic.svg#Poppins) format("svg")}@font-face{font-family:Poppins;font-style:normal;font-weight:700;src:url(/fonts/poppins-v15-latin-ext_latin_devanagari-700.eot);src:local(""),url(/fonts/poppins-v15-latin-ext_latin_devanagari-700.eot?#iefix) format("embedded-opentype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-700.woff2) format("woff2"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-700.woff) format("woff"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-700.ttf) format("truetype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-700.svg#Poppins) format("svg")}@font-face{font-family:Poppins;font-style:italic;font-weight:700;src:url(/fonts/poppins-v15-latin-ext_latin_devanagari-700italic.eot);src:local(""),url(/fonts/poppins-v15-latin-ext_latin_devanagari-700italic.eot?#iefix) format("embedded-opentype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-700italic.woff2) format("woff2"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-700italic.woff) format("woff"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-700italic.ttf) format("truetype"),url(/fonts/poppins-v15-latin-ext_latin_devanagari-700italic.svg#Poppins) format("svg")}</style><header class="header"><div class="container"><div class="row"><div class="header__inner col col-12"><div class="logo"><a class="logo__link"href="/"><img class="logo__image"src="/images/logo.png"alt="ᴍɪɢᴜᴇʟ ᴀɴɢᴇʟ ᴅᴏᴍɪɴɢᴜᴇᴢ ᴄᴏʟᴏᴍᴀ"> ᴍɪɢᴜᴇʟ ᴀɴɢᴇʟ ᴅᴏᴍɪɴɢᴜᴇᴢ ᴄᴏʟᴏᴍᴀ</a></div><div class="menu-overlay"><nav class="main-nav"><div class="main-nav__box"><div class="nav__icon-close"><i class="ion ion-md-close"></i></div><div class="nav-grid"><div class="nav-grid__item"><h2 class="nav-grid__title">Menu</h2><div class="mobile-nav"><ul class="nav__list list-reset"><li class="nav__item"><a style="font-size:1.2em"href="https://talegrounds.com"class="nav__link"target="_blank">Art</a><li class="nav__item"><a href="https://github.com/eridem"target="_blank"><i style="font-size:20px;margin-top:12px"class="ion ion-logo-github"></i></a><li class="nav__item"><a href="https://linkedin.com/in/eridem"target="_blank"><i style="font-size:20px;margin-top:12px"class="ion ion-logo-linkedin"></i></a></ul></div></div></div></div></nav></div><div class="navigation"><div class="top-nav"style="margin-top:-5px"><ul class="nav__list list-reset"><li class="nav__item"><a style="font-size:1.2em"href="https://talegrounds.com"class="nav__link"target="_blank">Art</a><li class="nav__item"><a href="https://github.com/eridem"target="_blank"><i style="font-size:20px;margin-top:12px"class="ion ion-logo-github"></i></a><li class="nav__item"><a href="https://linkedin.com/in/eridem"target="_blank"><i style="font-size:20px;margin-top:12px"class="ion ion-logo-linkedin"></i></a></ul></div><div class="nav-buttons"><i class="nav__icon nav__icon-menu ion ion-md-menu"></i> <i style="margin-top:-3px"class="nav__icon nav__icon-search ion ion-md-search"></i></div></div></div></div></div></header><div class="search"><div class="container"><div class="row"><div class="col col-12"><div class="search__box"><div class="search__close"><i class="ion ion-md-close"></i></div><div class="search__group"><label for="js-search-input"class="screen-reader-text">Search for Blog</label> <input id="js-search-input"class="search__text"autocomplete="off"placeholder="Type to search..."></div><div id="js-results-container"class="search-results-list"></div></div></div></div></div></div><main class="content"aria-label="Content"><div class="container"><div class="row"><div class="col col-12"><div class="image-box"><img class="post-image"src="/images/featured/2017-04-29-deploying-microservices-transparently-in-clusters-with-docker-and-nomad.jpg"alt="Deploying Microservices Transparently in Clusters with Docker and Nomad"></div></div></div></div><div class="container"><div class="row"><div class="col col-8 col-d-10 push-2 push-d-1 col-t-12 push-t-0"><article class="post animate"><div class="post-head"><div class="post-tags"><a href="/tag/platform"class="post-tags__tag">platform</a> <a href="/tag/infrastructure"class="post-tags__tag">infrastructure</a></div><h1 class="post-title">Deploying Microservices Transparently in Clusters with Docker and Nomad</h1><div class="post__meta"><span class="post__date"><time datetime="2017-04-29T00:00:00+02:00">Apr 29, 2017</time></span></div></div><div class="post__content"><h1 id="goal-and-pre-requisites">Goal and Pre-requisites</h1><p><strong><em>Nomad</em></strong> is a tool for managing a cluster of machines and running applications on them. It makes easy to decide what to deploy and which resources are needed abstracting the machines and locations.<p>Our goal will be deploy services in nodes transparently. With transparently, I refer to the fact that we will not need to know in which machines those services has been deployed. As well, <em>Nomad</em> will choose the right node to set up a new service and be sure that service can consume the necessary CPU and memory resources.<p>We will use <strong><em>Consul</em></strong> as service discovery because <em>Nomad</em> understands by default how to communicate with it and it will help us to add our microservices automatically into it.<p>You can download and install <em>Nomad</em>, <em>Consul</em> and <em>Docker</em> from the following links:<ul><li>Nomad: <a href="https://www.nomadproject.io/downloads.html">https://www.nomadproject.io/downloads.html</a><li>Consul: <a href="https://www.consul.io/downloads.html">https://www.consul.io/downloads.html</a><ul><li>For our demo, we will run <code class="language-plaintext highlighter-rouge">Consul</code> directly from Docker</ul><li>Docker: <a href="https://www.docker.com/community-edition">https://www.docker.com/community-edition</a></ul><h1 id="part-1-configuring-the-nodes">Part 1. Configuring the nodes</h1><p>Ideally, we should create the following infrastructure in production:<p><img src="images/posts/2017-04-29-deploying-microservices-transparently-in-clusters-with-docker-and-nomad/tutorial-full-setup.png"alt=""><p>But, for this tutorial, we will only set up one node with <em>Consul</em> and a <em>Nomad Server</em> all on the same machine to save some time and skip the autoscaling.<p><img src="images/posts/2017-04-29-deploying-microservices-transparently-in-clusters-with-docker-and-nomad/tutorial-setup.png"alt=""><ul><li><code class="language-plaintext highlighter-rouge">node-01.local</code>: this node will have <em>Nomad Server</em> installed which will be our proxy to deploy the services through the rest of the nodes (<code class="language-plaintext highlighter-rouge">node-02.local</code> and <code class="language-plaintext highlighter-rouge">node-03.local</code>). We will install <em>Consul</em> on here for service discovery.<li><code class="language-plaintext highlighter-rouge">node-02.local</code> and <code class="language-plaintext highlighter-rouge">node-03.local</code>: those are the ones where our deployments will end up. Those have exactly the same configurations.</ul><p>About the ports, we need to open the following ones:<ul><li><code class="language-plaintext highlighter-rouge">4646-4648</code> for all nodes in the subnet.<li><code class="language-plaintext highlighter-rouge">8500</code> for the node <code class="language-plaintext highlighter-rouge">node-01.local</code> in the subnet.<li><code class="language-plaintext highlighter-rouge">1025-65536</code> for the nodes <code class="language-plaintext highlighter-rouge">node-02.local</code> and <code class="language-plaintext highlighter-rouge">node-03.local</code> in the subnet to interact with the microservices.<li><code class="language-plaintext highlighter-rouge">8500,4646</code> for <code class="language-plaintext highlighter-rouge">node-01.local</code> publically from your office IP and CI server if you want to access to the <em>Consul</em> interface from <code class="language-plaintext highlighter-rouge">http://node-01.local:8500</code> and interact with <em>Nomad</em> in order to deploy new services.</ul><p>Be sure that the <em>Nomad</em> is installed in all nodes and <em>Consul</em> binary only on the <code class="language-plaintext highlighter-rouge">node-01.local</code>. <em>Docker</em> only needs to be installed on the <em>Client</em> nodes.<h2 id="setting-up-node-01local">Setting up node-01.local</h2><p><img src="images/posts/2017-04-29-deploying-microservices-transparently-in-clusters-with-docker-and-nomad/node-01.png"alt=""><h3 id="consul">Consul</h3><p>For <em>Consul</em> we will start it directly with <em>Docker</em> using:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--net</span><span class="o">=</span>host consul
</code></pre></div></div><p>At this moment, you should be able to reach <a href="http://node-01.local:8500">http://node-01.local:8500</a>.<p><img src="images/posts/2017-04-29-deploying-microservices-transparently-in-clusters-with-docker-and-nomad/node-01-consul.png"alt=""><h3 id="nomad">Nomad</h3><p>We will create a file called <code class="language-plaintext highlighter-rouge">~/nomad-server.nomad</code> with the following content. I added comments on the code that keep following the tutorial inside the code:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># The binding IP of our interface</span>
bind_addr <span class="o">=</span> <span class="s2">"0.0.0.0"</span>

<span class="c"># Where all configurations are saved </span>
data_dir <span class="o">=</span>  <span class="s2">"/home/ubuntu/nomad-config/"</span>
datacenter <span class="o">=</span>  <span class="s2">"dc1"</span>

<span class="c"># Act as server. We will use this node to communicate with Nomad</span>
<span class="c"># from other machines.</span>
server <span class="o">=</span>  <span class="o">{</span>
    enabled <span class="o">=</span>  <span class="nb">true</span>

    <span class="c"># The bootstrap_expected define how many Nomad server instances </span>
    <span class="c"># should be up running. We use only one for our tutorial, but </span>
    <span class="c"># in production we should have a odd number of instance </span>
    <span class="c"># running like 3, 5, ...</span>
    bootstrap_expect <span class="o">=</span>  1
<span class="o">}</span>

<span class="c"># Where Consul, our service discovery, is listening from.</span>
<span class="c"># For this tutorial, we are installing in the same place that </span>
<span class="c"># the Nomad server.</span>
consul <span class="o">=</span>  <span class="o">{</span>
    address <span class="o">=</span>  <span class="s2">"node-01.local:8500"</span>
<span class="o">}</span>

<span class="c"># Addresses to notify Consul how to find us. In this case, we are</span>
<span class="c"># accessible from the node-01.local domain</span>
advertise <span class="o">=</span>  <span class="o">{</span>
    http <span class="o">=</span>  <span class="s2">"node-01.local"</span>
    rpc  <span class="o">=</span>  <span class="s2">"node-01.local"</span>
    serf <span class="o">=</span>  <span class="s2">"node-01.local"</span>
<span class="o">}</span>
</code></pre></div></div><p>Then, we will start <em>Nomad</em> using this configuration using its CLI tool:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nomad agent <span class="nt">-config</span><span class="o">=</span><span class="nv">$HOME</span>/nomad-server.nomad
</code></pre></div></div><p>If we come back to <a href="http://node-01.local:8500">http://node-01.local:8500</a> we will see that the <em>Nomad</em> server has been registered and it advertises using <em>HTTP</em>, <em>RPC</em> and <em>SERF</em>.<p><img src="images/posts/2017-04-29-deploying-microservices-transparently-in-clusters-with-docker-and-nomad/node-01-consul-nomad.png"alt=""><p>Now, from our own computer, we can test the connectivity like this:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ NOMAD_ADDR</span><span class="o">=</span>http://node-01.local:4646 nomad server-members

Name            Address      Port  Status  Leader  Protocol  Build  Datacenter  Region
node-01.global  12.34.56.78  4648  alive   <span class="nb">true    </span>2         0.5.6  dc1         global
</code></pre></div></div><h2 id="setting-up-node-02local-and-node-03local">Setting up node-02.local and node-03.local</h2><p>The set up of the nodes which will host our services are not more difficult to set up. We need to run <em>Nomad</em> as client and connect it to the server one.<p>We will create a file called <code class="language-plaintext highlighter-rouge">~/nomad-client.nomad</code> with this content:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># The binding IP of our interface</span>
<span class="c"># Can be found using </span>
<span class="c"># ifconfig eth0 | awk '/inet addr/ { print $2}' | sed 's#addr:##g'</span>
bind_addr <span class="o">=</span> <span class="s2">"10.0.0.5"</span>

<span class="c"># Where all configurations are saved </span>
data_dir <span class="o">=</span>  <span class="s2">"/home/ubuntu/nomad-config/"</span>
datacenter <span class="o">=</span>  <span class="s2">"dc1"</span>

<span class="c"># Act as client and communicate with the server one</span>
client <span class="o">=</span>  <span class="o">{</span>
    enabled <span class="o">=</span>  <span class="nb">true</span>

    <span class="c"># Server addresses. If we have more than one, we</span>
    <span class="c"># can add them here</span>
    servers <span class="o">=</span> <span class="o">[</span><span class="s2">"node-01.local:4647"</span><span class="o">]</span>
<span class="o">}</span>

<span class="c"># Where Consul, our service discovery, is listening from.</span>
consul <span class="o">=</span>  <span class="o">{</span>
    address <span class="o">=</span>  <span class="s2">"node-01.local:8500"</span>
<span class="o">}</span>

<span class="c"># Addresses to notify Consul how to find us. </span>
<span class="c"># For this client, we are # accessible from </span>
<span class="c"># the node-02.local domain</span>
advertise <span class="o">=</span>  <span class="o">{</span>
    http <span class="o">=</span>  <span class="s2">"node-02.local"</span>
    rpc  <span class="o">=</span>  <span class="s2">"node-02.local"</span>
    serf <span class="o">=</span>  <span class="s2">"node-02.local"</span>
<span class="o">}</span>
</code></pre></div></div><p><strong>NOTE</strong>: replace <code class="language-plaintext highlighter-rouge">node-02.local</code> for <code class="language-plaintext highlighter-rouge">node-03.local</code> between the configurations of the clients.<p>Then, we will start the clients in a similar way than the server:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nomad agent <span class="nt">-config</span><span class="o">=</span><span class="nv">$HOME</span>/nomad-server.nomad
</code></pre></div></div><p><img src="images/posts/2017-04-29-deploying-microservices-transparently-in-clusters-with-docker-and-nomad/node-0203-consul-nomad.png"alt=""><h1 id="part-2-dockerizing-microservices">Part 2. Dockerizing microservices</h1><h2 id="skiping-this-section">Skiping this section?</h2><p>If you already know how to Dockerize you can skip this section. You can use directly the example <em>Docker</em> image I prepared:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-p</span> 3000:3000 eridemnet/microservice-example:1.0.0
</code></pre></div></div><p>And be sure it works opening these two endpoints:<ul><li><a href="http://localhost:3000/">http://localhost:3000/</a><li><a href="http://localhost:3000/health">http://localhost:3000/health</a></ul><h2 id="dockerizing-an-example-microservice">Dockerizing an example microservice</h2><p>We will create a new example microservice and <em>dockerize</em> it. We will deploy it multiple times with different names because this will prove already how the approach works.<p>We will use a small <em>Node.js</em> application. You need to have installed:<ul><li>Node.js: <a href="https://nodejs.org/en/">https://nodejs.org/en/</a><li>Yarn: <a href="https://yarnpkg.com/en/docs/install">https://yarnpkg.com/en/docs/install</a></ul><p>Then, we will create the following small microservice:<p><code class="language-plaintext highlighter-rouge">package.json</code><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"example-microservice"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microservice"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"index.js"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"standard"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node ."</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MIT"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"express"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.15.2"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"standard"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^10.0.2"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><p><code class="language-plaintext highlighter-rouge">index.js</code><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">packageInfo</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./package.json</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/health</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">ok</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Called to </span><span class="p">${</span><span class="nx">packageInfo</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">@</span><span class="p">${</span><span class="nx">packageInfo</span><span class="p">.</span><span class="nx">version</span><span class="p">}</span><span class="s2"> at </span><span class="p">${</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toString</span><span class="p">()}</span><span class="s2">`</span><span class="p">)</span>
  
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">`Hello from </span><span class="p">${</span><span class="nx">packageInfo</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">@</span><span class="p">${</span><span class="nx">packageInfo</span><span class="p">.</span><span class="nx">version</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">)</span>
</code></pre></div></div><p>Then, we can run it like this:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install dependencies</span>
<span class="nv">$ </span>yarn

<span class="c"># Run it</span>
<span class="nv">$ </span>yarn start
</code></pre></div></div><p>We can open the browser and test it using <a href="http://localhost:3000">http://localhost:3000</a>.<h3 id="health-endpoint"><code class="language-plaintext highlighter-rouge">/health</code> endpoint</h3><p>As we saw in the previous example, there is a special endpoint that can be fetched from <a href="http://localhost:3000/health">http://localhost:3000/health</a>. This endpoint will be useful to let <em>Consul</em> know that everything is up running on this microservice. We can do other checks on this endpoint, but so far an <code class="language-plaintext highlighter-rouge">ok</code> return should be enough.<h3 id="dockerizing-the-microservice">Dockerizing the microservice</h3><p>In order to <em>dockerize</em> this service, we will use an <code class="language-plaintext highlighter-rouge">alpine</code> version of <em>Node.js</em> and expose the port <code class="language-plaintext highlighter-rouge">3000</code>.<p><code class="language-plaintext highlighter-rouge">Dockerfile</code><div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> node:alpine</span>

<span class="k">RUN </span><span class="nb">mkdir</span> <span class="nt">-p</span> /workdir
<span class="k">COPY</span><span class="s"> ./package.json ./yarn.lock /workdir/</span>

<span class="k">RUN </span><span class="nb">cd</span> /workdir <span class="o">&amp;&amp;</span> yarn
<span class="k">COPY</span><span class="s"> * /workdir/</span>

<span class="k">EXPOSE</span><span class="s"> 3000</span>
<span class="k">WORKDIR</span><span class="s"> /workdir</span>

<span class="k">ENTRYPOINT</span><span class="s"> yarn start</span>
</code></pre></div></div><p>Now we will be able to build and run this service from a container:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Build image</span>
<span class="nv">$ </span>docker build <span class="nt">-t</span> microservice-01 <span class="nb">.</span>

<span class="c"># Run image</span>
<span class="nv">$ </span>docker run <span class="nt">--rm</span> <span class="nt">-p</span> 3000:3000 microservice-01
</code></pre></div></div><p>Now you should be able to access again to <a href="http://localhost:3000">http://localhost:3000</a>, but in this case, the service is running inside the container.<h3 id="deploying-our-image">Deploying our image</h3><p>To make this tutorial easier, we will deploy our container publically to the official Docker Hub <a href="https://hub.docker.com">https://hub.docker.com</a>. <em>Nomad</em> has options to use credentials for private Docker repositories, but those are easy to set up and does not give much more value to this tutorial.<p>Be sure you create an account in <a href="https://hub.docker.com">https://hub.docker.com</a> and create a repository named <code class="language-plaintext highlighter-rouge">microservice-example</code>.<p>Then, we can deploy our image (I will use my username <code class="language-plaintext highlighter-rouge">eridemnet</code> in the example):<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Login into our account</span>
<span class="nv">$ </span>docker login

<span class="c"># Build image</span>
<span class="nv">$ </span>docker build <span class="nt">-t</span> eridemnet/microservice-example:1.0.0 <span class="nb">.</span>

<span class="c"># Push the image to the repository</span>
<span class="nv">$ </span>docker push eridemnet/microservice-example:1.0.0
</code></pre></div></div><p>After few seconds, your image should be placed on your hub (using your username): <a href="https://hub.docker.com/r/eridemnet/microservice-example/tags/">https://hub.docker.com/r/eridemnet/microservice-example/tags/</a><h1 id="part-3-jobs-and-tasks">Part 3. Jobs and Tasks</h1><h2 id="jobs-and-tasks">Jobs and Tasks</h2><p><em>Nomad</em> has a way to organize its entities. Those are jobs, tasks and services.<ul><li><p><strong><em>Job</em></strong> is basically a set of configurations which will allow us to define how to trigger tasks or group of tasks.<li><p><strong><em>Task</em></strong> is the specifications about how to trigger a unit of work, such as a Docker container, a web application or a batch processing. Tasks can define which resources are needed to execute this unit of work, like network resources, CPU needed and so on. As well, they can define environment variables needed for this tasks and other metadata.<li><p><strong><em>Service</em></strong> is a subset of <em>Task</em> which defines that this task should be executed as a service in the background.</ul><p><img src="images/posts/2017-04-29-deploying-microservices-transparently-in-clusters-with-docker-and-nomad/nomad-entities-diagram.png"alt=""><h3 id="creating-a-job-for-our-microservice">Creating a job for our microservice</h3><p>We will create a new file called <code class="language-plaintext highlighter-rouge">microservice-job-01.nomad</code> and define within a <em>Task</em> using <em>Docker</em> and be executed as a <em>Service</em>. The following code is self-explanatory:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>job <span class="s2">"microservice-01"</span> <span class="o">{</span>
  <span class="nb">type</span> <span class="o">=</span> <span class="s2">"service"</span>
  datacenters <span class="o">=</span> <span class="o">[</span><span class="s2">"dc1"</span><span class="o">]</span>

  group <span class="s2">"Microservices"</span> <span class="o">{</span>

    <span class="c"># Number of services we want to deploy</span>
    <span class="c"># of this type</span>
    count <span class="o">=</span> <span class="s2">"1"</span>
    
    task <span class="s2">"microservice-01"</span> <span class="o">{</span>
      driver <span class="o">=</span> <span class="s2">"docker"</span>

      config <span class="o">{</span>
        <span class="c"># The image we want to use for deployment        </span>
        image <span class="o">=</span> <span class="s2">"eridemnet/microservice-example:1.0.0"</span>

        <span class="c"># The port exposed from the container</span>
        port_map <span class="o">{</span>
          http <span class="o">=</span> 3000
        <span class="o">}</span>
      <span class="o">}</span>

      <span class="c"># Memory resources for this </span>
      resources <span class="o">{</span>
        memory <span class="o">=</span> 256 <span class="c"># 256MB</span>
        network <span class="o">{</span>
          mbits <span class="o">=</span> <span class="s2">"10"</span>
          port <span class="s2">"http"</span> <span class="o">{}</span>
        <span class="o">}</span>
      <span class="o">}</span>

      <span class="c"># Act as service</span>
      service <span class="o">{</span>
        name <span class="o">=</span> <span class="s2">"microservice-01"</span>
        tags <span class="o">=</span> <span class="o">[</span><span class="s2">"microservice-01"</span>, <span class="s2">"microservice-example@1.0.0"</span><span class="o">]</span>
        port <span class="o">=</span> <span class="s2">"http"</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><h3 id="deploying-our-job">Deploying our job</h3><p>Let’s finally run the job and deploy our service.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Export the address of one Nomad server to use on the</span>
<span class="c"># rest of commands</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">NOMAD_ADDR</span><span class="o">=</span>http://node-01.local:4664 

<span class="c"># Get current jobs, it should be empty because we did not deploy any</span>
<span class="nv">$ </span>nomad status
    No running <span class="nb">jobs</span>

<span class="c"># We will deploy our services</span>
<span class="nv">$ </span>nomad run microservice-job-01.nomad
    <span class="o">==&gt;</span> Monitoring evaluation <span class="s2">"d30beea8"</span>
        Evaluation triggered by job <span class="s2">"microservice-01"</span>
        Allocation <span class="s2">"cb3116cf"</span> modified: node <span class="s2">"a379fe1f"</span>, group <span class="s2">"Microservices"</span>
        Evaluation status changed: <span class="s2">"pending"</span> -&gt; <span class="s2">"complete"</span>
    <span class="o">==&gt;</span> Evaluation <span class="s2">"d30beea8"</span> finished with status <span class="s2">"complete"</span>

<span class="c"># And check the status of the jobs</span>
<span class="nv">$ </span>nomad status
    ID               Type     Priority  Status
    microservice-01  service  50        running
</code></pre></div></div><p>Using the command <code class="language-plaintext highlighter-rouge">nomad run [file]</code> we deployed our service based on the configuration we defined previously. Running <code class="language-plaintext highlighter-rouge">nomad status</code> we can see that our job is running.<p><em>Job</em> and <em>Task</em> have different statuses. Running jobs does not guarantee that the task is running, so we can use the following command to obtain more information about its tasks:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Check the status of the task</span>
<span class="nv">$ </span>nomad status microservice-01
    ID            <span class="o">=</span> microservice-01
    Name          <span class="o">=</span> microservice-01
    Type          <span class="o">=</span> service
    Priority      <span class="o">=</span> 50
    Datacenters   <span class="o">=</span> dc1
    Status        <span class="o">=</span> running
    Periodic      <span class="o">=</span> <span class="nb">false
    </span>Parameterized <span class="o">=</span> <span class="nb">false

    </span>Summary
    Task Group     Queued  Starting  Running  Failed  Complete  Lost
    Microservices  0       0         1        0       1         0

    Allocations
    ID        Eval ID   Node ID   Task Group     Desired  Status    Created At
    cb3116cf  d30beea8  a379fe1f  Microservices  run      running   05/14/17 19:19:26 CEST
</code></pre></div></div><p>Now we can see the allocations which represent the real status of the tasks and check its logs using the allocation ID:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># We pick up the allocation ID from the status command</span>
<span class="nv">$ </span>nomad logs cb3116cf
    yarn start v0.23.4
    <span class="nv">$ </span>node <span class="nb">.</span>
</code></pre></div></div><p>We can receive more information from the running allocation using the command:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># We pick up the allocation ID from the status command</span>
<span class="nv">$ </span>nomad alloc-status cb3116cf
    ID                  <span class="o">=</span> cb3116cf
    Eval ID             <span class="o">=</span> 1cf46e6d
    Name                <span class="o">=</span> microservice-01.Microservices[0]
    Node ID             <span class="o">=</span> a379fe1f
    Job ID              <span class="o">=</span> microservice-01
    Client Status       <span class="o">=</span> running
    Client Description  <span class="o">=</span> &lt;none&gt;
    Desired Status      <span class="o">=</span> run
    Desired Description <span class="o">=</span> &lt;none&gt;
    Created At          <span class="o">=</span> 05/14/17 19:19:26 CEST

    Task <span class="s2">"microservice"</span> is <span class="s2">"running"</span>
    Task Resources
    CPU        Memory          Disk     IOPS  Addresses
    0/100 MHz  48 MiB/256 MiB  300 MiB  0     http: 10.0.0.5:39357

    Recent Events:
    Time                    Type        Description
    05/14/17 19:19:48 CEST  Started     Task started by client
    05/14/17 19:19:26 CEST  Driver      Downloading image eridemnet/microservice-example:1.0.0
    05/14/17 19:19:26 CEST  Task Setup  Building Task Directory
    05/14/17 19:19:26 CEST  Received    Task received by client
</code></pre></div></div><p>As we can see, our microservice is listening on the port <code class="language-plaintext highlighter-rouge">39357</code>. But we can receive this information automatically from <em>Consul</em>:<p><img src="images/posts/2017-04-29-deploying-microservices-transparently-in-clusters-with-docker-and-nomad/consul-running-microservice-01.png"alt=""><p>Using this binding IP <code class="language-plaintext highlighter-rouge">10.0.0.5</code> we recognized that it refers to the <code class="language-plaintext highlighter-rouge">node-02.local</code> server. So we will try out:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl http://node-02.local:59357
    Hello from microservice-01@1.0.0
</code></pre></div></div><p>And if we check again the logs from <em>Nomad</em>:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Check logs from allocation</span>
<span class="nv">$ </span>nomad logs cb3116cf
    yarn start v0.23.4
    <span class="nv">$ </span>node <span class="nb">.</span>
    Called to microservice-01@1.0.0 at Sun May 14 2017 17:44:39 GMT+0000 <span class="o">(</span>UTC<span class="o">)</span>
</code></pre></div></div><h2 id="stopping-a-job">Stopping a job</h2><p>If we would like to stop a <em>Job</em>, which represents a <em>Task</em> or a group of <em>Task</em>, we can stop them all using its name:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Retreive jobs running</span>
<span class="nv">$ </span>nomad status
    ID               Type     Priority  Status
    microservice-01  service  50        running

<span class="c"># Stop the job</span>
<span class="nv">$ </span>nomad stop microservice-01
</code></pre></div></div><h2 id="modifying-and-planning-jobs">Modifying and planning jobs</h2><p>We can modify our job files and redeploy them using <code class="language-plaintext highlighter-rouge">nomad run [file]</code>. But what if we want to see the consequences of the changes before deploying them?<p>For this example, we will modify our job <code class="language-plaintext highlighter-rouge">microservice-job-01.nomad</code> and modify the version of our <em>Docker</em> image:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c"># The image we want to use for deployment        </span>
        image <span class="o">=</span> <span class="s2">"eridemnet/microservice-example:1.0.1"</span>
</code></pre></div></div><p>Now, we will <strong><em>plan</em></strong> which are the changes between our local without applying them using:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nomad plan microservice-job-01.nomad

    +/- Job: <span class="s2">"microservice-01"</span>
    +/- Task Group: <span class="s2">"Microservices"</span> <span class="o">(</span>1 create/destroy update<span class="o">)</span>
    +/- Task: <span class="s2">"microservice"</span> <span class="o">(</span>forces create/destroy update<span class="o">)</span>
        +/- Config <span class="o">{</span>
        +/- image:             <span class="s2">"eridemnet/microservice-example:1.0.0"</span> <span class="o">=&gt;</span> <span class="s2">"eridemnet/microservice-example:1.0.1"</span>
            port_map[0][http]: <span class="s2">"3000"</span>
            <span class="o">}</span>

    Scheduler dry-run:
    - All tasks successfully allocated.

    Job Modify Index: 8843
    To submit the job with version verification run:

    nomad run <span class="nt">-check-index</span> 8843 job.nomad
</code></pre></div></div><p>As we can see, the microservice will upgrade from <code class="language-plaintext highlighter-rouge">1.0.0</code> to <code class="language-plaintext highlighter-rouge">1.0.1</code> in this line:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        +/- image:             <span class="s2">"eridemnet/microservice-example:1.0.0"</span> <span class="o">=&gt;</span> <span class="s2">"eridemnet/microservice-example:1.0.1"</span>
</code></pre></div></div><p>Another thing that we can see is that <em>Nomad</em> creates a unique index to apply this specific plan. This will prevent to change the jobs accidentally and apply those changes by mistake:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nomad run <span class="nt">-check-index</span> 8843 job.nomad
    <span class="o">==&gt;</span> Monitoring evaluation <span class="s2">"041a2877"</span>
        Evaluation triggered by job <span class="s2">"microservice-01"</span>
        Allocation <span class="s2">"b3d82c0b"</span> created: node <span class="s2">"a379fe1f"</span>, group <span class="s2">"Microservices"</span>
        Evaluation status changed: <span class="s2">"pending"</span> -&gt; <span class="s2">"complete"</span>
    <span class="o">==&gt;</span> Evaluation <span class="s2">"041a2877"</span> finished with status <span class="s2">"complete"</span>
</code></pre></div></div><h1 id="part-4-problems-with-nomad">Part 4. Problems with Nomad</h1><p>There are few problems with <em>Nomad</em> at the current version (<em>0.5.6</em>) just when I wrote this article (<em>2017-05-27</em>). They may be solved at the time the reader reach this section.<h2 id="services-down-on-unexisting-docker-image">Services down on unexisting Docker image</h2><p>If we run a job with an unexisting Docker image, <em>Nomad</em> will shut down the previous jobs and try to start the new ones. Once that <em>Nomad</em> realized that the image does not exist, it will not try to recover the previous ones, making your jobs unavailable and do not rolling back:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>05/20/17 16:27:49 CEST  Restarting      Exceeded allowed attempts, applying a delay - Task restarting <span class="k">in </span>19.591207551s
05/20/17 16:27:49 CEST  Driver Failure  failed to initialize task <span class="s2">"microservice"</span> <span class="k">for </span>alloc <span class="s2">"e3f54673-ffc7-aa32-1b9e-6be18b0c2487"</span>: Failed to pull <span class="sb">`</span>eridemnet/microservice-example:non-existing<span class="sb">`</span>: API error <span class="o">(</span>404<span class="o">)</span>: <span class="o">{</span><span class="s2">"message"</span>:<span class="s2">"manifest for eridemnet/microservice-example:non-existing not found"</span><span class="o">}</span>
05/20/17 16:27:48 CEST  Driver          Downloading image eridemnet/microservice-example:non-existing
05/20/17 16:27:29 CEST  Restarting      Task restarting <span class="k">in </span>18.223988831s
</code></pre></div></div><p>We will not be able to see these changes on <em>Consul</em> because the previous instance was gratefully shut down.<p>If we increment our <code class="language-plaintext highlighter-rouge">count</code> property, this will still not working and we will see our jobs being shut down one by one.<h2 id="do-not-wait-for-a-health-check">Do not wait for a health check</h2><p>When we deploy a microservice, this may take a while to start. Maybe we are doing some initial checks, initializing a database or contacting other microservices before it is ready. Then we may decide to put our <code class="language-plaintext highlighter-rouge">/health</code> endpoint to return OK answers.<p><em>Nomad</em> will not wait for this health check and kill instantly our previous versions.<p>The only way to resolve this issue is having our <code class="language-plaintext highlighter-rouge">count</code> to more than <code class="language-plaintext highlighter-rouge">1</code> and increment the <code class="language-plaintext highlighter-rouge">update.stagger</code> seconds to between updates so each instance has time enough to restart. This number of seconds is something we need to guess.<p>Could it not be good to have an old version running until the new one is healthy in <em>Consul</em>?<h1 id="more-to-discover">More to discover</h1><p>We only cover the few features that <em>Nomad</em> offers us. I hope the reader got inspiration enough to keep this <em>Nomad</em> journey for him/herself and try it out!</div><div class="post__share"><div class="share__head"><div class="share__title">Share this article</div></div><ul class="share__list list-reset"><li class="share__item"><a class="share__link share__facebook"href="https://www.facebook.com/sharer/sharer.php?u=https://eridem.net/deploying-microservices-transparently-in-clusters-with-docker-and-nomad"onclick='return window.open(this.href,"pop-up","left=20,top=20,width=500,height=500,toolbar=1,resizable=0"),!1'title="Share on Facebook"rel="nofollow"><i class="ion ion-logo-facebook"></i></a><li class="share__item"><a class="share__link share__twitter"href="https://twitter.com/intent/tweet?text=Deploying%20Microservices%20Transparently%20in%20Clusters%20with%20Docker%20and%20Nomad&url=https://eridem.net/deploying-microservices-transparently-in-clusters-with-docker-and-nomad"onclick='return window.open(this.href,"pop-up","left=20,top=20,width=500,height=500,toolbar=1,resizable=0"),!1'title="Share on Twitter"rel="nofollow"><i class="ion ion-logo-twitter"></i></a><li class="share__item"><a class="share__link share__linkedin"href="https://www.linkedin.com/shareArticle?mini=true&url=https://eridem.net/deploying-microservices-transparently-in-clusters-with-docker-and-nomad&title=Deploying%20Microservices%20Transparently%20in%20Clusters%20with%20Docker%20and%20Nomad&summary=&source=%E1%B4%8D%C9%AA%C9%A2%E1%B4%9C%E1%B4%87%CA%9F%20%E1%B4%80%C9%B4%C9%A2%E1%B4%87%CA%9F%20%E1%B4%85%E1%B4%8F%E1%B4%8D%C9%AA%C9%B4%C9%A2%E1%B4%9C%E1%B4%87%E1%B4%A2%20%E1%B4%84%E1%B4%8F%CA%9F%E1%B4%8F%E1%B4%8D%E1%B4%80"onclick='return window.open(this.href,"pop-up","left=20,top=20,width=500,height=500,toolbar=1,resizable=0"),!1'title="Share on LinkedIn"rel="nofollow"><i class="ion ion-logo-linkedin"></i></a><li class="share__item"><a class="share__link share__pinterest"href="http://pinterest.com/pin/create/button/?url=https://eridem.net/deploying-microservices-transparently-in-clusters-with-docker-and-nomad&amp;media=https://eridem.net/images/featured/2017-04-29-deploying-microservices-transparently-in-clusters-with-docker-and-nomad.jpg&amp;description=Deploying%20Microservices%20Transparently%20in%20Clusters%20with%20Docker%20and%20Nomad"onclick='return window.open(this.href,"pop-up","left=20,top=20,width=900,height=500,toolbar=1,resizable=0"),!1'title="Share on Pinterest"rel="nofollow"><i class="ion ion-logo-pinterest"></i></a></ul></div><div class="post__navigation"><a class="prev"href="/hostify"><img src="/images/featured/2017-02-19-hostify.jpg"><div class="post__nav-box"><div class="post__nav post__nav__prev"><i class="ion ion-ios-arrow-back"></i> Previous Page</div><h4 class="post__nav__title">Hostify</h4></div></a><a class="next"href="/edison-2017-demoscene-kprna"><img src="/images/featured/2017-07-02-edison-2017-demoscene-kprna.jpg"><div class="post__nav-box"><div class="post__nav post__nav__next">Next Page <i class="ion ion-ios-arrow-forward"></i></div><h4 class="post__nav__title">Edison 2017, Demoscene by KpRñA</h4></div></a></div></article></div></div></div></main><div class="top"title="Top"><i class="ion ion-ios-arrow-up"></i></div><footer class="footer"><div class="container"><div class="row"><div class="col col-12 col-d-10 push-d-1 col-m-12 push-m-0"><div class="footer__inner"><div class="social"><ul class="social__list list-reset"><li class="social__item"><a class="social__link"href="https://github.com/eridem"target="_blank"><i class="ion ion-logo-github"></i></a><li class="social__item"><a class="social__link"href="https://linkedin.com/in/eridem"target="_blank"><i class="ion ion-logo-linkedin"></i></a></ul></div><div class="copyright">ᴄᴏᴘʏʀɪɢʜᴛ © 2024 <a href="/"><strong>ᴇʀɪᴅᴇᴍ ᴀʙ</strong></a></div></div></div></div></div></footer><script src="/js/vendors/jquery-3.3.1.min.js"></script><script src="/js/vendors/simple-jekyll-search.min.js"></script><script>SimpleJekyllSearch({searchInput:document.getElementById("js-search-input"),resultsContainer:document.getElementById("js-results-container"),json:"/search.json",searchResultTemplate:'<div class="search-results__item"><a class="search-results__link" href="{url}"><div class="result-title">{title}</div> <span class="search-results-date"> <time datetime="{date}">{date}</time></span></a></div>',noResultsText:'<li class="no-results"><h3>No results found</h3></li>'})</script><script src="/js/vendors/jquery.fitvids.js"></script><script src="/js/vendors/transition.js"></script><script src="/js/vendors/zoom.min.js"></script><script src="/js/common.js"></script><script>var base_url="",pagination_next_url=base_url+"/page2",pagination_next_page_number="",pagination_available_pages_number=""</script>